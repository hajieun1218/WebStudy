<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sist.mapper.freeboard-reply-mapper">
	
	<!-- mybatis 에서의 프로시저 호출
		  프로시저 함수호출은 무조건 SELECT -->
	
	<!-- 
		private int no;
		private int bno;
		private String id;
		private String name;
		private String msg;
		private Date regdate;
		private int group_id;
		private int group_step;
		private int group_tab;
		private int root;
		private int depth;
		private String dbday;
	 -->
	 <!-- CURSOR일 때는 resultMap 설정 해줘야함!! pResult를 어떤변수,어떤VO에 들어갈지 설정
			설정 안해주면 error (시작하자마자 xml을 먼저 읽기때문에)  -->
	 <resultMap type="BoardReplyVO" id="boardReplyMap">
	 	<result property="no" column="no"/>
	 	<result property="bno" column="bno"/>
	 	<result property="id" column="id"/>
	 	<result property="name" column="name"/>
	 	<result property="msg" column="msg"/>
	 	<result property="regdate" column="regdate"/>
	 	<result property="group_id" column="group_id"/>
	 	<result property="group_step" column="group_step"/>
	 	<result property="group_tab" column="group_tab"/>
	 	<result property="root" column="root"/>
	 	<result property="depth" column="depth"/>
	 	<result property="dbday" column="dbday"/>
	 </resultMap>
	
	
	
	<!-- 
		CREATE OR REPLACE PROCEDURE replyListData(
		    pStart NUMBER,
		    pEnd NUMBER,
		    pBno freeboard_reply.bno%TYPE,
		    pResult OUT SYS_REFCURSOR
		)
	 -->
	 <!-- property : Map의 key -->
	<parameterMap type="hashMap" id="replyListDataMap">
		<parameter property="pStart" javaType="java.lang.Integer" jdbcType="INTEGER" mode="IN"/>
		<parameter property="pEnd" javaType="java.lang.Integer" jdbcType="INTEGER" mode="IN"/>
		<parameter property="pBno" javaType="java.lang.Integer" jdbcType="INTEGER" mode="IN"/>
		<parameter property="pResult" jdbcType="CURSOR" mode="OUT" resultMap="boardReplyMap"/> <!-- 커서는 자바에 없으므로 설정하지 않는다 -->
	</parameterMap>
	
	<select id="replyListData2" parameterMap="replyListDataMap" statementType="CALLABLE">
		{CALL replyListData(?,?,?,?)}
	</select>
	
	
	
	<!-- 
		CREATE OR REPLACE PROCEDURE replyInsert(
		    pBno freeboard_reply.bno%TYPE,
		    pId member.id%TYPE,
		    pName member.name%TYPE,
		    pMsg freeboard_reply.msg%TYPE
		)
	 -->
	<parameterMap type="hashMap" id="replyInsertMap">
		<parameter property="pBno" javaType="java.lang.Integer" jdbcType="INTEGER" mode="IN"/>
	 	<parameter property="pId" javaType="java.lang.String" jdbcType="VARCHAR" mode="IN"/>
	 	<parameter property="pName" javaType="java.lang.String" jdbcType="VARCHAR" mode="IN"/>
	 	<parameter property="pMsg" javaType="java.lang.String" jdbcType="CLOB" mode="IN"/>
	</parameterMap>
	
	<select id="replyInsert2" parameterMap="replyInsertMap" statementType="CALLABLE">
	 	{CALL replyInsert(?,?,?,?)}
	</select>
	
	
	
	<!-- 
		CREATE OR REPLACE PROCEDURE replyTotalPage(
		    pBno freeboard_reply.bno%TYPE,
		    pTotal OUT NUMBER
		)
	 -->
	<parameterMap type="hashMap" id="replyTotalMap">
		<parameter property="pBno" javaType="java.lang.Integer" jdbcType="INTEGER" mode="IN"/>
		<parameter property="pTotal" javaType="java.lang.Integer" jdbcType="INTEGER" mode="OUT"/>
	</parameterMap>
	
	<select id="replyTotalPage2" parameterMap="replyTotalMap" statementType="CALLABLE">
		{CALL replyTotalPage(?,?)}
	</select>
</mapper>